---
  machine:
    node:
      version: 0.10.33
    services:
      - mongodb
      - docker

  dependencies:
    post:
      - gulp build
      - cd dist && npm install

  test:
    pre:
      - echo $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
      - docker build -t $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME .
      - >
        docker run -dit -p 80:8080
        $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
    override:
      - gulp test
